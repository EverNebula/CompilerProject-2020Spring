# Project1 

## 概述与分工
Project1要求我们实现简单向量计算语句到C++语言的翻译。为了方便项目的分工和并行，我们将全部工作分为 __Paser__、__IRBuilder__、__Codegen__三个部分，分别用来词法语法分析、构建IR树、生成C++代码。具体分工如下：

邬涵博：
徐昊天：
刘镇：

## Parser
由于给定的语法简单而有规律，我们使用语法规律人工实现了一个简单的解析器。在程序使用`jsoncpp`读入源json文件后，会首先去掉语句所有的空格，并将占两个字符的`//`运算符替换为`$`方便处理。处理过后的语句将会被送入解析器的入口`Parse_P`函数进行词法语法分析。
具体的解析过程详见`parser.h`以及`parser.cc`文件。

## IRBuilder
**构造IR树**：为了方便，IR抽象语法树的构建其实是与解析同步进行的，解析每个非终结符号或终结符号都会建立对应节点并返回相应的Expr，下层节点返回相应Expr后，上层节点就可以对应建立节点并继续返回Expr，想当于整棵语法树以后序遍历的顺序构造节点实例，最后得到Kernel节点。

**关于更新Index边界**：全局记录一个Index的Vector，记作index_list，每次遇到Index，若不在index_list里则插入，若在，则根据Index对应的范围(<>)和Index的表达式解出新的范围，并根据缩小范围的原则进行更新，最终得到的index_list里的全部为正确范围，最后根据其生成for循环部分。

## Codegen
生成C++代码我们主要



**生成函数签名** ： 记录每个变量名称及其范围，生成签名时根据json字符串里的输入输出确定变量顺序。

**生成临时变量** ： 每个块都使用一个临时变量，编号temp1、temp2、～tempN，并记录他们的范围，最后在生成函数体最开始声明所有这些temp变量。